# Run this using jruby or else the threads won't run in parallel.
# Actually, don't run this at all, because it's not the proper solution
$prev = [
    %w[. . | # . . # . . . . . . # | . # . . # | # . | # # | . | . # # . | | . . | . | | . . . . # # # | .],
    %w[| | . | . . . . | # . # | . # . . . # . | . . . | # . # . # . # . . . . # . . . . . . # . . . . # .],
    %w[. . . # . . . | . . . . . # . # . . | # . . . | | . . # . | . | # . . . . # | # | . . # # . . . | .],
    %w[. . . . . # . . . . | # . | . . | . . . . . # | # # . . . # . # . # | | . . . . | | | | . . . . # .],
    %w[. . # # # . . . # . | | . | | | . # # . # . | . . . . | . # # . # . . . . | . # . | . . | . . . . .],
    %w[. . . . | . . # . # . | . . . | . . | . . . . . # . . . . # . # . . . . . . . | . | | . . . | . . .],
    %w[# . . | . . . . . # # | . . # . . # . . . # . . | . # # . . . . . # . . . . . . | | # # | . | # . .],
    %w[# # . . . . . . . . # . . . | # | . # # . # | # . . # | . . . # . . . # . # # | | | . # | | . . | |],
    %w[. . . . . . # . . | . . | . # . . . | # | | . # . . . . # . # . | # . | | . . . . . . | . . . . . |],
    %w[. | . . . | . # # . . . . # . | | . . . | . . | . . | . | . . . . . . . . # . # . . | | | . . | # #],
    %w[. . | . . . . | . . . # # # # # . . | # | . . | . . . # . . . # . | . . . | . . | . | . . | . # | #],
    %w[. . . . | . . . # . # . # . . . . . . . # . . . . . . # . # | . . . . . . # | . # # . . # # . # | .],
    %w[. . . . . | . # . . | # . . . | | . . # . . . . . . | . . # . | # . # | . . . # | . | . . # | | . .],
    %w[# . . . . # . . . . . . . | # . | . . | . . . # . . . | . . | . # # | # . | # . # | . . . . . | . .],
    %w[. . . . # . | | # . . . . . # . . # . . . | . . . . # # . # . . . . . . . # . | . | | | . | . . . .],
    %w[| . | . . | | # # . . . . | # . . # . . | . . | . | . | . . | | | . # # . . # . | . . . . . . # # |],
    %w[# # # . . | . # | # # | # . | | | . # | . # . . | # | . . # . . | . # | . . . . # . # . # . . | | .],
    %w[. | . . . . . | # . # . | # | | . . # . . . . . # . | . | | . # . | . . . . . | # . . | . . . # . .],
    %w[. . . # # . . . . . . . . . | . . . # . # | . . . . # # . . # . | . | . . . . . . . # . . | . . . |],
    %w[. . # . # . | . | . . . . . | | # . . | | . . . # # | | . # | . . | . . . . . # | . . . | . . . # |],
    %w[. . . . # . . . # | | . . | . . . | . | . . | # . # . . . . . . . . . | # . . . # . | | | . . . # .],
    %w[. # . . | . # # . | . | . # . . . # . . . . . # . # . . . . . . . | # . | . # | | # . # . . . . . #],
    %w[| . . . # | . . # . . . . # . . . | . # # . # # # # . . . . | # . # # | # . # . | . . . . . | | . .],
    %w[. . . . | . # . | # | | . . | # . | . | . # | . . . | . # . . . . | | . # . . . # | . # . . . | . #],
    %w[. | . . # . # . . | # | . . # # . . | . # # . . | | . . . # . . . | | . . . . # | | . . # . | . . .],
    %w[# # . . . . . . # . | . . . | . | | . # . | | . . . . | . . . . . . . # . . . . . . # # | # . . | .],
    %w[| # . . . . # | | . . . . # # . . . . . . . . . . . # . | . . . . | . . . . | # | # . | . . # . . .],
    %w[. . # . . . # | . . . . | . | . . | . . . # . . . . . . . # . # # . # . . . . . # . | | . . . . . .],
    %w[. . . | . . . . # | # . . # | . . . | . . . # | . . . . # . # | . . . . . . . | . . . . . . . | # .],
    %w[. # | | . . # # | | . | . . | . | # . . | . | . . . . | . # | . | . | . . . . . # . # . | . . # . #],
    %w[. . . . . | . . | . . . | . . . | . . . . . . | | . . . # # . . . . . # # . . . . . . . | . # . . |],
    %w[. . . . . # . . # | . # . . . # . . # . . . | | . | # # . . | # . . # # . | # . . . . . # # . . . .],
    %w[| . . . | . # | | . . . . . . . . . # . . # . . # | | | | . . . . | . . . | . . | . . # . . . # # .],
    %w[# . # . . | . | . . . . . . . | | . . | # | . . | . . . . | . | # | # | . | . . | . | . . . # . # .],
    %w[# . | . . | | # . | | | | . . # # # . | . . . . . . | . # | | | . # # . . . . . . . . | | . . . | |],
    %w[. . . . . # | . . # . # . . . . . | . . | # . . . . . | . . . . | . # | | | # . | . . . . . # . . .],
    %w[. . . | | # . . # . . . # . . . | | # . | | . . . . . . | # . . # . . # . | # . | # | . . . | . . #],
    %w[. | | . . . . . | | . . | # . | # | | . . . # # . . # # # | . # . . . . | . | . . | # . . . # | . |],
    %w[. . . # . | # | | . . # . | | | . . . . . . # . . . | | . # . . | | | . . | # . | . # # . . # . | #],
    %w[. # | | . . # . | | | . . . . . . . | . | # . . . . . | . | # . # . . # # . . | . | . . . . | # . .],
    %w[. . # . # # # . . | . . . . . . . . . | . . . . . # . . # # # | . | # . . . . . . . . . . # | . # |],
    %w[# . | | . | . # . | . . | | # | | | # . . # # . | # . . . . # . # . | . # . . . . . | . | . # . | #],
    %w[| . . | . . # . # . . | . # . . . . . . . # . . . # . | . . | . . | # . . | . . # # # | . | | . . |],
    %w[| . . | . . . | | . . . | . # . # . . # # | . # . . # . . . # | # . . | . # . . | . # . . | . | | .],
    %w[. . # . # # . . # . | . . # . # . . | . . | # . | | | . # . . # . . | # # # # # . | . . # . . . . .],
    %w[. | . | # . | # . . . | | . . # # . . . # | # . . . . . . . . . # . . . # | . . # # . # . # . . # .],
    %w[# # | . | . . # . # | . . . . # . . | . . # . . . . # . . . . . . # | | . | . . . . | | # # . . | |],
    %w[. # # | # . . . . # . . # . . # . . . . . # | . # . . . # . . # . | # | | | | . # # . # . . . . | .],
    %w[. . | . . . . . . . # | . . . . | # | . . | | . . # # . . # . | # | . . # . # | . . . . | . . # | #],
    %w[. . . . | | | . | | | # . . | | . . . | | | . # # . . # . # | # # . . . . | . . | . . | | . . # | #],
]
# $prev = [
# %w[. # . # . . . | # . ],
# %w[. . . . . # | # # | ],
# %w[. | . . | . . . # . ],
# %w[. . | # . . . . . # ],
# %w[# . # | | | # | # | ],
# %w[. . . # . | | . . . ],
# %w[. | . . . . | . . . ],
# %w[| | . . . # | . # | ],
# %w[| . | | | | . . | . ],
# %w[. . . # . | . . | . ]
# ]

$new = Marshal.load(Marshal.dump($prev))

def getSurroundingAcres(r, c)
    surrounding = []

    if r-1 >= 0
        surrounding << $prev[r-1][c-1] unless c-1 < 0
        surrounding << $prev[r-1][c]
        surrounding << $prev[r-1][c+1]
    end

    surrounding << $prev[r][c-1] unless c-1 < 0
    # ignoring $prev[r][c]
    surrounding << $prev[r][c+1]

    if $prev[r+1] != nil
        surrounding << $prev[r+1][c-1] unless c-1 < 0
        surrounding << $prev[r+1][c]
        surrounding << $prev[r+1][c+1]
    end

    surrounding
    # ^^ this gets returned since its the last value
end

def calculateChange(char, c, r)
    surrounding = getSurroundingAcres(r, c)
    case char
    when "."
        $new[r][c] = "|" if surrounding.count("|") >= 3
    when "|"
        $new[r][c] = "#" if surrounding.count("#") >= 3
    when "#"
        $new[r][c] = "." unless surrounding.include? "#" and surrounding.include? "|"
    end
end

# answer with 10: 394420
# answer with 1000000000:
start = Time.now
threads = []
10000.times do |num|
    # $prev.each_with_index do |row, r|
    threads[0] = Thread.new do
        (0..9).each do |r|
            $prev[r].each_with_index do |char, c|
                calculateChange(char, c, r)
            end
        end
    end

    threads[1] = Thread.new do
        (10..19).each do |r|
            $prev[r].each_with_index do |char, c|
                calculateChange(char, c, r)
            end
        end
    end

    threads[2] = Thread.new do
        (20..29).each do |r|
            $prev[r].each_with_index do |char, c|
                calculateChange(char, c, r)
            end
        end
    end

    threads[3] = Thread.new do
        (30..39).each do |r|
            $prev[r].each_with_index do |char, c|
                calculateChange(char, c, r)
            end
        end
    end

    threads[4] = Thread.new do
        (40..49).each do |r|
            $prev[r].each_with_index do |char, c|
                calculateChange(char, c, r)
            end
        end
    end

    # end
    threads.each { |thr| thr.join }
    # threads.each { |thr| Thread.kill(thr) }

    # print $prev
    # puts num
    # print $new
    # puts

    # this operation is sloooooww
    $prev = Marshal.load(Marshal.dump($new))
    # $prev = $new.dup
end
endTime = Time.now
puts "time: #{endTime - start}"

trees = 0
lumber = 0
$new.count do |row|
    trees += row.count("|")
    lumber += row.count("#")
end

puts trees
puts lumber
puts trees * lumber
